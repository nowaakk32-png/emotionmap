<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="stylesheet" href="css/map.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <title>emotionmap - —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –≥–æ—Ä–æ–¥–∞</title>
  </head>
  <body>
    <header>
      <span class="logo"
        ><img src="assests/icons/4599477.png" alt="" width="32" height="32" />
        emotionmap</span
      >
      <nav>
        <ul>
          <li class="active">–ö–∞—Ä—Ç–∞</li>
          <li class="map"><a href="about.html">–û –ø—Ä–æ–µ–∫—Ç–µ</a></li>
        </ul>
      </nav>
    </header>
    <div class="container">

      <section class="hero">
  <h2>–û—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ—é —ç–º–æ—Ü–∏—é –∏ —Å–¥–µ–ª–∞–π—Ç–µ –≤–∫–ª–∞–¥ –≤ –∏–∑—É—á–µ–Ω–∏–µ –≥–æ—Ä–æ–¥—Å–∫–æ–π —Å—Ä–µ–¥—ã</h2>
  <a href="/" class="hero-button">üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
  <h4>&#9660; –ª–∏—Å—Ç–∞–π—Ç–µ –≤–Ω–∏–∑ &#9660;</h4>
</section>

      <div id="map"></div>

      <div id="emotionModal" class="emotion-modal">
        <div class="modal-content">
            <h3 class="modal-title">–í—ã–±–µ—Ä–∏—Ç–µ —ç–º–æ—Ü–∏—é –¥–ª—è —ç—Ç–æ–≥–æ –º–µ—Å—Ç–∞</h3>
            
            <div class="emotion-options">
                <div class="emotion-option" data-emotion="happy">
                    <span class="emotion-emoji">üéâ</span>
                    <span class="emotion-name">–†–∞–¥–æ—Å—Ç—å</span>
                </div>
                <div class="emotion-option" data-emotion="calm">
                    <span class="emotion-emoji">üòä</span>
                    <span class="emotion-name">–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ</span>
                </div>
                <div class="emotion-option" data-emotion="neutral">
                    <span class="emotion-emoji">üòê</span>
                    <span class="emotion-name">–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ</span>
                </div>
                <div class="emotion-option" data-emotion="sad">
                    <span class="emotion-emoji">üò¢</span>
                    <span class="emotion-name">–ì—Ä—É—Å—Ç—å</span>
                </div>
                <div class="emotion-option" data-emotion="angry">
                    <span class="emotion-emoji">üò†</span>
                    <span class="emotion-name">–†–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ</span>
                </div>
            </div>
            
            <textarea class="comment-input" placeholder="–ü–æ—á–µ–º—É —ç—Ç–æ –º–µ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç —Ç–∞–∫–∏–µ —ç–º–æ—Ü–∏–∏? (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
            
            <div class="modal-buttons">
                <button class="modal-btn btn-cancel" id="cancelBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn btn-add" id="addBtn" disabled>–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>

        </div>
      </div>
    </div>
    <footer class="modern-footer">
        <div class="footer-container">
          <div class="footer-section">
            <h3 class="footer-logo">
              <img src="assests/icons/4599477.png" alt="EmotionMap" width="24" height="24" />
              EmotionMap
            </h3>
            <p class="footer-description">
              –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –≥–æ—Ä–æ–¥–∞, —Å–æ–∑–¥–∞–Ω–Ω–∞—è –≤–∞–º–∏. –ò—Å—Å–ª–µ–¥—É–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, –¥–µ–ª–∏—Ç–µ—Å—å –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è–º–∏ –∏ –ø–æ–º–æ–≥–∞–π—Ç–µ –¥–µ–ª–∞—Ç—å –≥–æ—Ä–æ–¥ –ª—É—á—à–µ.
            </p>
            <div class="social-links">
        <a href="https://vk.com/id791334928" target="_blank" aria-label="VK"><img src="assests/icons/icons8-vk-50.png" alt=""></a>
        <a href="https://t.me/Ilya14032" target="_blank" aria-label="Telegram"><img src="assests/icons/icons8-telegram-50.png" alt=""></a>
        <a href="mailto:nowaakk32@gmail.com" aria-label="Email"><img src="assests/icons/icons8-gmail-50.png" alt=""></a>
            </div>
          </div>
          <div class="footer-section">
            <h4>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h4>
            <ul class="footer-links">
              <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
              <li><a href="/map.html">–ö–∞—Ä—Ç–∞</a></li>
              <li><a href="/about.html">–û –ø—Ä–æ–µ–∫—Ç–µ</a></li>
              <li><a href="#stats-section">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a></li>
            </ul>
          </div>
          <div class="footer-section">
            <h4>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h4>
            <p>üìç –ö–∞–ª–∞—á, –í–æ—Ä–æ–Ω–µ–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</p>
            <p>üìû +7 939 945 30 93</p>
            <p>‚úâÔ∏è nowaakk32@gmail.com</p>
            <p>üë®‚Äçüíª –ê–≤—Ç–æ—Ä: –ò–ª—å—è –ë–∞–±–∏–Ω</p>
          </div>

    <!-- –ö–æ–ª–æ–Ω–∫–∞ 4: –î–æ–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="footer-section">
      <h4>EmotionMap</h4>
      <ul class="footer-links">
        <li>5000+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞</li>
        <li>–°–æ–±–∏—Ä–∞–ª–æ—Å—å —Å —Å–µ–Ω—Ç—è–±—Ä—è 2025</li>
        <li>100% —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞</li>
        <li>–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: html, css, Node.js, Leaflet, SQLite</li>
      </ul>
    </div>
  </div>

  <div class="footer-bottom">
    <p>&copy; 2026 EmotionMap. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
    <p>–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –≤ –ö–∞–ª–∞—á–µ</p>
  </div>
</footer>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const SERVER_URL = window.location.origin;
  let map, selectedEmotion = null, clickCoords = null;

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã —Å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–µ–π
  function initInteractiveMap() {
    // –°–æ–∑–¥–∞—ë–º –∫–∞—Ä—Ç—É –±–µ–∑ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞
    map = L.map('map');

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);

    // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const { latitude, longitude } = position.coords;
          map.setView([latitude, longitude], 14); // –ó—É–º 14 ‚Äî –±–ª–∏–∂–µ –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–µ–µ
          console.log("üìç –ö–∞—Ä—Ç–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", latitude, longitude);
        },
        (error) => {
          console.warn("‚ö†Ô∏è –ì–µ–æ–ø–æ–∑–∏—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞:", error.message);
          // –†–µ–∑–µ—Ä–≤: —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –Ω–∞ –ö–∞–ª–∞—á, –í–æ—Ä–æ–Ω–µ–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å
          map.setView([50.424119, 41.01624], 12);
        },
        {
          timeout: 10000,        // –ú–∞–∫—Å. –æ–∂–∏–¥–∞–Ω–∏–µ ‚Äî 10 —Å–µ–∫
          maximumAge: 300000     // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à –¥–æ 5 –º–∏–Ω—É—Ç
        }
      );
    } else {
      // –ï—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Geolocation
      console.log("‚ùå Geolocation –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –ö–∞–ª–∞—á");
      map.setView([50.424119, 41.01624], 12);
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–∫–∏
    loadMarkers();

    // –í–µ—à–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∫–∞—Ä—Ç—É
    map.on('click', (e) => {
      showEmotionModal(e.latlng.lat, e.latlng.lng);
    });
  }

  async function loadMarkers() {
    try {
      const res = await fetch(`${SERVER_URL}/api/markers`);
      const markers = await res.json();
      const emoji = { happy: 'üéâ', calm: 'üòä', neutral: 'üòê', sad: 'üò¢', angry: 'üò†' };
      const names = { happy: '–†–∞–¥–æ—Å—Ç—å', calm: '–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ', neutral: '–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ', sad: '–ì—Ä—É—Å—Ç—å', angry: '–†–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ' };

      markers.forEach(m => {
        const icon = L.divIcon({
          html: `<div class="emotion-marker marker-${m.emotion}">${emoji[m.emotion]}</div>`,
          iconSize: [40, 40],
          iconAnchor: [20, 20]
        });
        const popup = `<b>${names[m.emotion]}</b>${m.comment ? `<br><i>${m.comment}</i>` : ''}`;
        L.marker([m.lat, m.lng], { icon }).addTo(map).bindPopup(popup);
      });
    } catch (e) {
      console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ç–æ–∫:", e);
    }
  }

  function showEmotionModal(lat, lng) {
    clickCoords = { lat, lng };
    selectedEmotion = null;
    document.querySelector('.comment-input').value = '';
    document.querySelectorAll('.emotion-option').forEach(el => el.classList.remove('selected'));
    document.getElementById('addBtn').disabled = true;
    document.getElementById('emotionModal').style.display = 'flex';
  }

  function hideEmotionModal() {
    document.getElementById('emotionModal').style.display = 'none';
  }

  async function saveMarker(lat, lng, emotion, comment) {
    const res = await fetch(`${SERVER_URL}/api/markers`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ lat, lng, emotion, comment })
    });
    if (!res.ok) throw new Error((await res.json()).error || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
    return await res.json();
  }

  function notify(text, isError = false) {
    const el = document.createElement('div');
    el.className = `notification${isError ? ' error' : ''}`;
    el.textContent = text;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 3000);
  }

  // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  document.addEventListener('DOMContentLoaded', () => {
    initInteractiveMap();

    // –í—ã–±–æ—Ä —ç–º–æ—Ü–∏–∏
    document.querySelectorAll('.emotion-option').forEach(opt => {
      opt.addEventListener('click', () => {
        document.querySelectorAll('.emotion-option').forEach(o => o.classList.remove('selected'));
        opt.classList.add('selected');
        selectedEmotion = opt.dataset.emotion;
        document.getElementById('addBtn').disabled = false;
      });
    });

    // –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∫—É
    document.getElementById('addBtn').addEventListener('click', async () => {
      if (!selectedEmotion || !clickCoords) return;
      const btn = document.getElementById('addBtn');
      const comment = document.querySelector('.comment-input').value;
      btn.disabled = true;
      btn.textContent = '–î–æ–±–∞–≤–ª—è–µ–º...';
      try {
        await saveMarker(clickCoords.lat, clickCoords.lng, selectedEmotion, comment);
        notify('–≠–º–æ—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
        hideEmotionModal();
        // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –æ–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–∫–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
        // loadMarkers();
      } catch (e) {
        notify(`–û—à–∏–±–∫–∞: ${e.message}`, true);
      } finally {
        btn.disabled = false;
        btn.textContent = '–î–æ–±–∞–≤–∏—Ç—å';
      }
    });

    // –û—Ç–º–µ–Ω–∞
    document.getElementById('cancelBtn').addEventListener('click', hideEmotionModal);
    document.getElementById('emotionModal').addEventListener('click', (e) => {
      if (e.target === e.currentTarget) hideEmotionModal();
    });

    // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
    if (!window.location.origin) {
      window.location.origin = window.location.protocol + "//" + window.location.host;
    }
  });
</script>

  </body>
</html>



